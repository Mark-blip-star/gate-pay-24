// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  publicKey    String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  userSettings UserSettings?
  payments     Payment[]
}

model UserSettings {
  id          String   @id @default(uuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  callbackUrl String?
  redirectUrl String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("userSettings")
}

model Payment {
  id                    String    @id @default(uuid())
  stripePaymentIntentId String?
  userId                String
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  amount                Decimal   @db.Decimal(12, 2)
  currency              String
  status                String
  method                String?   
  payAccount            String?   // params[account]
  projectId             String?
  sum                   String?
  sign                  String?
  checkSign             String?   // params[check_sign]
  localpayId            String?
  paymentType           String?   // applepay, card, etc.
  revenue               Decimal?  @db.Decimal(12, 2)
  desc                  String?
  ordernum              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@index([stripePaymentIntentId])
  @@index([localpayId])
}

model ProcessedStripeEvent {
  id          String   @id @default(uuid())
  eventId     String   @unique
  processedAt DateTime @default(now())

  @@index([eventId])
  @@map("processedStripeEvent")
}
